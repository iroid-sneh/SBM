<script>
    fetch("/bmadmin/dashboard", {
        headers: {
            Authorization: "Bearer " + localStorage.getItem("accessToken"),
        },
    })
        .then((res) => res.json())
        .then(console.log)
        .catch(console.error);
</script>
<div
    class="bg-white rounded-tl-[40px] rounded-br-[90px] p-6 shadow-md flex justify-between items-center"
>
    <h1 class="text-2xl font-medium text-gray-500">Dashboard</h1>

    <!-- Residence Selector -->
    <div class="relative">
        <select
            class="appearance-none bg-[#5AC1C9] text-white text-sm font-medium px-4 py-2 pr-8 mr-10 rounded-md focus:outline-none"
        >
            <option>Residence 1</option>
            <option>Residence 2</option>
            <option>Residence 3</option>
        </select>
        <div
            class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white"
        >
            <svg class="w-4 h-4 fill-current" viewBox="0 0 20 20">
                <path
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                />
            </svg>
        </div>
    </div>
</div>

<!-- Stats Cards Row -->
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 p-6">
    <!-- Total Flat -->

    <div
        class="bg-white rounded-[15px] border-[2px] border-[#54B7C5]/50 p-4 flex items-center gap-4 shadow"
    >
        <!-- Icon circle -->
        <div class="bg-[#E4F0FF] p-5 rounded-full flex items-center justify-center">
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/ActiveTechnician.png"
                alt="Technician Icon"
                class="w-10 h-10 object-contain"
            />
        </div>

        <!-- Text -->
        <div class="flex flex-row gap-4 justify-center items-center">
            <span class="text-2xl font-bold text-black">03</span>
            <span class="text-gray-500 font-medium text-lg leading-tight">
                Active
                <br />
                Technician
            </span>
        </div>
    </div>
    <div
        class="bg-white rounded-[15px] border border-[2px] border-[#54B7C5]/50 p-4 flex items-center gap-4 shadow"
    >
        <!-- Icon circle -->
        <div class="bg-[#E4F0FF] p-5 rounded-full flex items-center justify-center">
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/ActiveSecurity.png"
                alt="Technician Icon"
                class="w-10 h-10 object-contain"
            />
        </div>

        <!-- Text -->
        <div class="flex flex-row gap-4 justify-center items-center">
            <span class="text-2xl font-bold text-black">06</span>
            <span class="text-gray-500 font-medium text-lg leading-tight">
                Active
                <br />
                Security
            </span>
        </div>
    </div>
    <div
        class="bg-white rounded-[15px] border border-[2px] border-[#54B7C5]/50 p-4 flex items-center gap-4 shadow"
    >
        <!-- Icon circle -->
        <div class="bg-[#E4F0FF] p-5 rounded-full flex items-center justify-center">
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/reservationreq.png"
                alt="Technician Icon"
                class="w-10 h-10 object-contain"
            />
        </div>

        <!-- Text -->
        <div class="flex flex-row gap-4 justify-center items-center">
            <span class="text-2xl font-bold text-black">12</span>
            <span class="text-gray-500 font-medium text-lg leading-tight">
                Reservation
                <br />
                Requests
            </span>
        </div>
    </div>
    <div
        class="bg-white rounded-[15px] border border-[2px] border-[#54B7C5]/50 p-4 flex items-center gap-4 shadow"
    >
        <!-- Icon circle -->
        <div class="bg-[#E4F0FF] p-5 rounded-full flex items-center justify-center">
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/unsolvedcases.png"
                alt="Technician Icon"
                class="w-10 h-10 object-contain"
            />
        </div>

        <!-- Text -->
        <div class="flex flex-row gap-4 justify-center items-center">
            <span class="text-2xl font-bold text-black">01</span>
            <span class="text-gray-500 font-medium text-lg leading-tight">
                Unsolved
                <br />
                Cases
            </span>
        </div>
    </div>
    <div
        class="bg-white rounded-[15px] border border-[2px] border-[#54B7C5]/50 p-4 flex items-center gap-4 shadow"
    >
        <!-- Icon circle -->
        <div class="bg-[#E4F0FF] p-5 rounded-full flex items-center justify-center">
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/pendingmaintenance.png"
                alt="Technician Icon"
                class="w-10 h-10 object-contain"
            />
        </div>

        <!-- Text -->
        <div class="flex flex-row gap-4 justify-center items-center">
            <span class="text-2xl font-bold text-black">02</span>
            <span class="text-gray-500 font-medium text-lg leading-tight">
                Pending
                <br />
                Maintenance
            </span>
        </div>
    </div>
</div>

<!-- second row -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 px-8 pb-6">
    <div class="bg-white border rounded-[25px] p-4 h-[calc(79vh-8rem)] overflow-y-auto">
        <!-- Calendar Section -->
        <div class="mb-6">
            <h2 class="text-[#888] text-lg text-center font-bold mb-4">Events Calendar</h2>

            <!-- Centered container for the calendar -->
            <div class="flex flex-col items-center">
                <!-- Centered calendar -->
                <div class="w-full flex justify-center">
                    <div class="w-full max-w-xs">
                        <div
                            id="datepicker-inline"
                            inline-datepicker
                            data-date="today"
                            class="rounded-lg shadow mx-auto"
                            datepicker-autohide
                        ></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Horizontal Line -->
        <hr class="my-4 border-gray-200" />

        <!-- Events Details Section -->
        <div>
            <h2 class="text-[#888] text-lg text-center font-bold mb-4">Events Details</h2>

            <!-- Arrows -->
            <div class="flex justify-center items-center mb-4 space-x-4">
                <button id="prevEvent" class="p-2 rounded-full hover:bg-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 19l-7-7 7-7"
                        />
                    </svg>
                </button>
                <button id="nextEvent" class="p-2 rounded-full hover:bg-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                        />
                    </svg>
                </button>
            </div>

            <!-- Event info container -->
            <div id="eventDetails" class="space-y-3">
                <!-- JavaScript will render content here -->
            </div>
        </div>
    </div>

    <div class="space-y-4">
        <!-- Total Rent Collection -->
        <div class="bg-white rounded-2xl shadow-md p-5 h-[170px] flex flex-col justify-between">
            <div>
                <h2 class="text-sm text-gray-500 font-semibold mb-3">Total Rent Collection</h2>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img
                            src="<%= process.env.APP_URL_ADMIN %>/Icons/images/wallet 1.png"
                            alt="wallet"
                            class="w-10 h-10"
                        />
                        <p class="text-xs text-gray-400">Total Amount:</p>
                    </div>
                    <p class="text-2xl font-bold text-black">15,729.00 BHD</p>
                </div>
            </div>
            <a href="#" class="flex items-center text-[#2573C2] text-xs underline gap-1">
                <img
                    src="<%= process.env.APP_URL_ADMIN %>/Icons/images/clockicon.png"
                    alt="clock"
                    class="w-4 h-4"
                />
                <span>Transactions History</span>
            </a>
        </div>

        <!-- Total Rent Overdue -->
        <div class="bg-white rounded-2xl shadow-md p-5 h-[170px] flex flex-col justify-between">
            <div>
                <h2 class="text-sm text-gray-500 font-semibold mb-3">Total Rent Overdue</h2>
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img
                            src="<%= process.env.APP_URL_ADMIN %>/Icons/images/sandglass 2.png"
                            alt="hourglass"
                            class="w-10 h-10"
                        />
                        <p class="text-xs text-gray-400">Total Amount:</p>
                    </div>
                    <p class="text-2xl font-bold text-black">4,754.78 BHD</p>
                </div>
            </div>
            <a href="#" class="flex items-center text-[#2573C2] text-xs underline gap-1">
                <img
                    src="<%= process.env.APP_URL_ADMIN %>/Icons/images/clockicon.png"
                    alt="clock"
                    class="w-4 h-4"
                />
                <span>Transactions History</span>
            </a>
        </div>

        <!-- Complaints Overview -->
        <div
            class="bg-white rounded-2xl shadow-md p-5 flex items-center justify-between gap-x-6 h-[200px]"
        >
            <!-- Chart.js Canvas Circle -->
            <div class="relative w-36 h-36">
                <canvas id="complaintChart" width="140" height="140"></canvas>
                <div
                    class="absolute inset-0 flex flex-col items-center justify-center text-center text-sm font-semibold"
                >
                    <p class="text-black">Complaints</p>
                    <p class="text-lg font-bold">
                        <%= completed + underReview + reported %>/<%= total %>
                    </p>
                </div>
            </div>

            <!-- Stats Box -->
            <div class="border border-gray-200 rounded-xl p-4 text-sm w-[150px] space-y-3">
                <div class="flex justify-between">
                    <span class="font-semibold text-red-600">Reported</span>
                    <span class="font-bold"><%= reported %></span>
                </div>
                <div class="flex justify-between">
                    <span class="font-semibold text-[#54B7C5]">Under Review</span>
                    <span class="font-bold"><%= underReview %></span>
                </div>
                <div class="flex justify-between">
                    <span class="font-semibold text-[#163F75]">Completed</span>
                    <span class="font-bold"><%= completed %></span>
                </div>
            </div>
        </div>
    </div>

    <!-- chat -->
    <div class="flex h-[calc(75vh-8rem)] bg-white border rounded-[25px]">
        <!-- <div class="w-full border-r">
                        <div class="p-4 border-b">
                            <h3 class="font-bold text-lg">Live Support</h3>
                            <div class="relative mt-2">
                                <input
                                    type="text"
                                    placeholder="Search"
                                    class="w-full pl-8 pr-4 py-2 border rounded-lg"
                                />
                                <svg
                                    class="absolute left-2.5 top-2.5 h-4 w-4 text-gray-400"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                    />
                                </svg>
                            </div>
                        </div>

                        <div class="p-4 hover:bg-gray-50 cursor-pointer">
                            <div class="flex justify-between">
                                <span class="font-medium">Elmer Laverty</span>
                                <span class="text-xs text-gray-500">12m</span>
                            </div>
                            <p class="text-sm text-gray-500 truncate">Ament Minim mollit non...</p>
                        </div>

                        <div class="p-4 hover:bg-gray-50 cursor-pointer">
                            <div class="flex justify-between">
                                <span class="font-medium">Florencio Dorrance</span>
                                <span class="text-xs text-gray-500">24m</span>
                            </div>
                            <p class="text-sm text-gray-500 truncate">woohoooo</p>
                        </div>
                    </div> -->
        <div class="w-full flex flex-col">
            <div class="p-4 border-b">
                <h3 class="font-bold">Elmer Laverty</h3>
            </div>

            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                <div class="flex items-start gap-2">
                    <div class="bg-gray-200 rounded-full w-8 h-8"></div>
                    <div>
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p>Amet minim mollit non deserunt ullamco est sit aliqua dolor.</p>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">09:40 AM</p>
                    </div>
                </div>

                <div class="flex items-start gap-2 justify-end">
                    <div>
                        <div class="bg-blue-500 text-white rounded-lg p-3 max-w-xs">
                            <p>
                                Amet minim mollit non deserunt ullamco est sit aliqua dolor do amet
                                sint.
                            </p>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 text-right">09:40 AM</p>
                    </div>
                    <div class="bg-blue-500 rounded-full w-8 h-8"></div>
                </div>
            </div>

            <div class="p-4 border-t">
                <div class="relative">
                    <input
                        type="text"
                        placeholder="Write Here..."
                        class="w-full pl-4 pr-12 py-3 border rounded-lg"
                    />
                    <button class="absolute right-2 top-2 text-blue-500 mt-1">
                        <svg
                            aria-hidden="true"
                            class="w-6 h-6 rotate-[90deg]"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"
                            ></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const eventDates = ["2025-06-09", "2025-06-14"];

    function addDotsToCalendar() {
        const todayISO = getTodayISO();

        setTimeout(() => {
            document.querySelectorAll("[data-date]").forEach((cell) => {
                let isoDate;

                const attr = cell.getAttribute("data-date");

                if (attr === "today") {
                    isoDate = todayISO;
                } else {
                    const ts = parseInt(attr);
                    if (!isNaN(ts)) {
                        const dateObj = new Date(ts);
                        const year = dateObj.getFullYear();
                        const month = String(dateObj.getMonth() + 1).padStart(2, "0");
                        const day = String(dateObj.getDate()).padStart(2, "0");
                        isoDate = `${year}-${month}-${day}`;
                    }
                }

                if (eventDates.includes(isoDate)) {
                    if (!cell.querySelector(".event-dot")) {
                        const dot = document.createElement("div");
                        dot.className = "event-dot w-1.5 h-1.5 bg-gray-300 rounded-full mx-auto";
                        cell.appendChild(dot);
                    }
                }
            });
        }, 10);
    }

    document.addEventListener("DOMContentLoaded", addDotsToCalendar);

    const calendar = document.getElementById("datepicker-inline");
    const observer = new MutationObserver(addDotsToCalendar);
    observer.observe(calendar, { childList: true, subtree: true });

    function getTodayISO() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, "0");
        const day = String(today.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
    }

    // Events Details
    const events = [
        {
            name: "Cook-Out",
            place: "Links Restaurant",
            date: "28.10.2023",
            time: "16:00 PM",
            members: 12,
        },
        {
            name: "Board Meeting",
            place: "Office HQ",
            date: "09.05.2025",
            time: "11:00 AM",
            members: 8,
        },
        {
            name: "Team Lunch",
            place: "Olive Bistro",
            date: "12.05.2025",
            time: "13:00 PM",
            members: 10,
        },
    ];

    let currentEventIndex = 0;

    function renderEvent(index) {
        const event = events[index];
        const container = document.getElementById("eventDetails");

        container.innerHTML = `
          <div class="flex justify-between items-center bg-[#f6f6f6] border rounded-[25px] p-3">
              <span class="text-gray-500">Event Name</span>
              <span class="font-medium">${event.name}</span>
          </div>
          <div class="flex justify-between items-center bg-[#f6f6f6] border rounded-[25px] p-3">
              <span class="text-gray-500">Place</span>
              <span class="font-medium">${event.place}</span>
          </div>
          <div class="flex justify-between items-center bg-[#f6f6f6] border rounded-[25px] p-3">
              <span class="text-gray-500">Date</span>
              <span class="font-medium">${event.date}</span>
          </div>
          <div class="flex justify-between items-center bg-[#f6f6f6] border rounded-[25px] p-3">
              <span class="text-gray-500">Time</span>
              <span class="font-medium">${event.time}</span>
          </div>
          <div class="flex justify-between items-center bg-[#f6f6f6] border rounded-[25px] p-3">
              <span class="text-gray-500">Total Members</span>
              <span class="font-medium">${event.members}</span>
          </div>
      `;
    }

    // Initialize first event
    document.addEventListener("DOMContentLoaded", () => {
        renderEvent(currentEventIndex);
    });

    // Navigation
    document.getElementById("prevEvent").addEventListener("click", () => {
        if (currentEventIndex > 0) {
            currentEventIndex--;
            renderEvent(currentEventIndex);
        }
    });

    document.getElementById("nextEvent").addEventListener("click", () => {
        if (currentEventIndex < events.length - 1) {
            currentEventIndex++;
            renderEvent(currentEventIndex);
        }
    });

    const total = `<%= total %>`;
    const completed = `<%= completed %>`;
    const underReview = `<%= underReview %>`;
    const reported = `<%= reported %>`;

    const ctx = document.getElementById("complaintChart").getContext("2d");

    new Chart(ctx, {
        type: "doughnut",
        data: {
            labels: ["Completed", "Under Review", "Reported"],
            datasets: [
                {
                    data: [completed, underReview, reported],
                    backgroundColor: ["#163F75", "#54B7C5", "#EF4444"],
                    borderWidth: 0,
                },
            ],
        },
        options: {
            cutout: "70%",
            responsive: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: true },
            },
        },
    });
</script>
