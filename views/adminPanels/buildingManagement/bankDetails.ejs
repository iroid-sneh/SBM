<html>
    <head>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/flowbite@1.6.5/dist/flowbite.min.js"></script>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    </head>
    <body
        class="bg-cover bg-no-repeat min-h-screen relative overflow-hidden bg-gradient-to-t from-[#163F75]/50 to-[#54B7C5]/50"
    >
        <% if (messages.success && messages.success.length > 0) { %>
        <script>
            const SBM_PRIMARY = "#54B7C5";
            Swal.fire({
                icon: "success",
                title: "Success",
                text: `<%= messages.success[0]?.replace(/"/g, '') %>`,
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                background: "#ffffff",
                color: "#222",
                iconColor: SBM_PRIMARY,
                customClass: {
                    popup: "shadow-lg rounded-xl border border-gray-200",
                    title: "text-[#222] font-medium",
                    timerProgressBar: "bg-[#54B7C5]",
                },
            });
        </script>
        <% } %> <% if (messages.error && messages.error.length > 0) { %>
        <script>
            Swal.fire({
                icon: "error",
                title: "Error",
                text: `<%= messages.error[0]?.replace(/"/g, '') %>`,
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                background: "#ffffff",
                color: "#222",
                iconColor: "#e74c3c",
                customClass: {
                    popup: "shadow-lg rounded-xl border border-gray-200",
                    title: "text-[#222] font-medium",
                    timerProgressBar: "bg-red-400",
                },
            });
        </script>
        <% } %>
        <div
            class="absolute inset-0 bg-cover bg-no-repeat opacity-20 z-0"
            style="
                background-image: url('<%= process.env.APP_URL_ADMIN %>/Icons/images/BMAuthBg.png');
            "
        ></div>
        <div class="relative w-full">
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/BMAuthTop.svg"
                alt="Top Right Decoration"
                class="absolute top-0 right-0 w-[834px] pointer-events-none z-10"
            />
            <img
                src="<%= process.env.APP_URL_ADMIN %>/Icons/images/BMLogo.png"
                alt="BM Logo"
                class="absolute top-3 right-40 w-[280px] z-20"
            />
        </div>
        <form
            id="bank-form"
            method="post"
            action="/bmadmin/bankdetails/step4"
            enctype="application/x-www-form-urlencoded"
        >
            <div
                class="mx-auto flex items-start justify-between px-[200px] relative z-10 top-[220px]"
            >
                <div class="w-[472px] px-6">
                    <div id="auth-container">
                        <div class="flex justify-center items-center">
                            <h2
                                class="text-2xl items-start justify-start text-center text-white mb-[80px]"
                                id="form-title"
                            >
                                Bank Details
                            </h2>
                        </div>
                        <div class="space-y-3">
                            <div
                                class="flex items-center bg-white px-4 py-4 rounded-[10px] border shadow-xl"
                            >
                                <input
                                    name="accountName"
                                    type="text"
                                    placeholder="Account Name"
                                    class="w-full h-[14px] text-m focus:outline-none"
                                />
                            </div>
                            <div
                                class="flex items-center bg-white px-4 py-4 rounded-[10px] border shadow-xl"
                            >
                                <input
                                    name="accountNumber"
                                    type="text"
                                    placeholder="Account Number"
                                    class="w-full h-[14px] text-m focus:outline-none"
                                />
                            </div>
                            <div
                                class="flex items-center bg-white px-4 py-4 rounded-[10px] border shadow-xl"
                            >
                                <input
                                    name="IBAN"
                                    type="text"
                                    placeholder="IBAN"
                                    class="w-full h-[14px] text-m focus:outline-none"
                                />
                            </div>
                            <div class="flex bg-white px-4 py-4 rounded-[10px] border shadow-xl">
                                <select
                                    name="bankName"
                                    id="bankNameSelect"
                                    class="w-full h-[21px] text-m text-gray-400 focus:outline-none"
                                >
                                    <option value="" hidden>Bank Name</option>
                                    <option value="Ithmaar Bank">Ithmaar Bank</option>
                                    <option value="Chase">Chase</option>
                                    <option value="JP Morgan Bank">JP Morgan Bank</option>
                                </select>
                            </div>
                            <div
                                class="flex items-center bg-white px-4 py-4 rounded-[10px] border shadow-xl"
                            >
                                <input
                                    name="billingAddress"
                                    type="text"
                                    placeholder="Billing Address"
                                    class="w-full h-[14px] text-m focus:outline-none"
                                />
                            </div>
                            <label class="flex items-start gap-2 text-sm text-white leading-snug">
                                <input type="checkbox" class="mt-1 scale-110 accent-[#163f75]" />
                                <p class="text-sm leading-snug">
                                    My Billing and Business address are the same
                                </p>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="absolute right-[15%] top-1/2 -translate-y-[-40px]">
                    <h2 class="text-5xl text-white">Your bank details are secure</h2>
                    <h2 class="text-5xl mt-2 text-white">and encrypted with us</h2>
                </div>
            </div>
            <div>
                <img
                    src="<%= process.env.APP_URL_ADMIN %>/Icons/images/BMAuthBottom.svg"
                    alt="Bottom Left Decoration"
                    class="absolute bottom-0 left-0 w-[1044px] pointer-events-none"
                />
                <div
                    class="absolute bottom-8 left-0 w-full flex items-center justify-between px-[280px]"
                >
                    <div class="">
                        <h2 class="text-4xl font-semibold text-gray-800">
                            Step 4
                            <span class="text-gray-500 font-normal">out of 6</span>
                        </h2>
                    </div>
                    <div class="flex items-center gap-6">
                        <button
                            onclick="window.location.href='<%= process.env.APP_ADMIN_URL %>/bmadmin/residencedetails'"
                            class="text-base font-medium text-white hover:underline"
                        >
                            &lt; Back
                        </button>

                        <button
                            type="submit"
                            class="bg-[#54B7C5] hover:bg-[#54B7C5]/80 text-white text-lg font-medium rounded-xl px-[100px] py-3 transition"
                        >
                            Save & Continue
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </body>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        document.getElementById("bank-form").addEventListener("submit", function (e) {
            const errors = [];

            const accountName = document.querySelector('input[name="accountName"]').value.trim();
            const accountNumber = document
                .querySelector('input[name="accountNumber"]')
                .value.trim();
            const IBAN = document.querySelector('input[name="IBAN"]').value.trim();
            const bankName = document.querySelector('select[name="bankName"]').value.trim();
            const billingAddress = document
                .querySelector('input[name="billingAddress"]')
                .value.trim();

            // === Basic validations ===
            if (!accountName) errors.push("Account Name is required.");
            if (!accountNumber || isNaN(accountNumber))
                errors.push("Valid Account Number is required.");
            if (!IBAN) errors.push("IBAN is required.");
            if (!bankName) errors.push("Bank Name is required.");
            if (!billingAddress) errors.push("Billing Address is required.");

            if (errors.length > 0) {
                e.preventDefault();

                let swalOptions = {
                    icon: "error",
                    toast: true,
                    position: "top-end",
                    showConfirmButton: false,
                    timer: 4000,
                    timerProgressBar: true,
                    background: "#fff",
                    iconColor: "#e74c3c",
                    color: "#222",
                    customClass: {
                        popup: "shadow-lg rounded-xl border border-gray-200",
                        title: "text-[#222] font-medium",
                        timerProgressBar: "bg-red-400",
                    },
                };

                const totalRequiredFieldsCount = 5;
                if (errors.length === totalRequiredFieldsCount) {
                    swalOptions.title = "All input fields are required.";
                    swalOptions.text = "";
                } else if (errors.length === 1) {
                    swalOptions.title = errors[0];
                    swalOptions.text = "";
                } else {
                    swalOptions.title = "Please fill in all required fields:";
                    swalOptions.html = errors.map((e) => `<div>${e}</div>`).join("");
                }

                Swal.fire(swalOptions);
                return;
            }
        });
    </script>
</html>
