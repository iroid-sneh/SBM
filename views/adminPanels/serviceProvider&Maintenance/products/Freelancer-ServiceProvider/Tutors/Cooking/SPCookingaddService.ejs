<div class="bg-[#f7f6f5] rounded-[100px] flex-1 justify-center items-center">
    <!-- Breadcrumb -->
    <div class="flex p-10 ml-10 items-center space-x-4">
        <h3 class="text-gray-600 text-lg">Products</h3>
        <div class="w-px h-7 bg-gray-300"></div>

        <!-- 4 Grid Icon -->
        <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M2 4.33333C2 2.58319 2.01874 2 4.33333 2C6.64793 2 6.66667 2.58319 6.66667 4.33333C6.66667 6.08348 6.67405 6.66667 4.33333 6.66667C1.99262 6.66667 2 6.08348 2 4.33333Z"
                stroke="#163F75"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M9.33203 4.33333C9.33203 2.58319 9.35077 2 11.6654 2C13.98 2 13.9987 2.58319 13.9987 4.33333C13.9987 6.08348 14.0061 6.66667 11.6654 6.66667C9.32465 6.66667 9.33203 6.08348 9.33203 4.33333Z"
                stroke="#163F75"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M2 11.6654C2 9.91522 2.01874 9.33203 4.33333 9.33203C6.64793 9.33203 6.66667 9.91522 6.66667 11.6654C6.66667 13.4155 6.67405 13.9987 4.33333 13.9987C1.99262 13.9987 2 13.4155 2 11.6654Z"
                stroke="#163F75"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M9.33203 11.6654C9.33203 9.91522 9.35077 9.33203 11.6654 9.33203C13.98 9.33203 13.9987 9.91522 13.9987 11.6654C13.9987 13.4155 14.0061 13.9987 11.6654 13.9987C9.32465 13.9987 9.33203 13.4155 9.33203 11.6654Z"
                stroke="#163F75"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
        </svg>

        <!-- Arrow -->
        <svg width="24" height="16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
                d="M5.668 3.335L10.335 8 5.668 12.668M13.668 3.335L18.335 8 13.668 12.668"
                stroke="black"
                stroke-width="1.2"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
        </svg>

        <h3 class="text-[black] text-lg">Add Service</h3>
    </div>

    <!-- Main Content Container -->
    <div class="w-[1400px] h-[640px] bg-white rounded-2xl p-4 mx-auto flex">
        <!-- Left Panel (Form) -->
        <div class="w-[40%] pr-6">
            <p class="text-md text-gray-900 font-medium mb-2">Add Details of your Service</p>

            <!-- Custom Styled Select Wrapper -->
            <div class="relative w-full mb-4 h-[48px]">
                <div
                    class="flex items-center px-4 py-3 bg-white border border-gray-300 rounded-xl text-sm text-gray-700 shadow-lg"
                >
                    <span id="selectedCategory" class="flex-1 text-gray-500">Select Category</span>
                    <svg
                        class="w-4 h-4 text-gray-400"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
                <!-- Hidden actual select -->
                <select
                    id="category"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                    onchange="handleCategoryChange()"
                >
                    <option value="" hidden>Select Category</option>
                    <option value="Indian">Indian</option>
                    <option value="Italian">Italian</option>
                    <option value="Chinese">Chinese</option>
                    <option value="Mexican">Mexican</option>
                </select>
            </div>

            <!-- Add Items with Button -->
            <div class="flex shadow-lg rounded-xl">
                <input
                    id="addItemInput"
                    type="text"
                    placeholder="Add Dishes"
                    class="flex-1 px-4 py-3 rounded-l-xl border border-r-0 border-gray-300 text-sm text-gray-700 bg-gray-100"
                    disabled
                />
                <button
                    id="addItemBtn"
                    class="px-5 py-3 bg-[#b6c1d2] text-white text-sm font-semibold rounded-r-xl"
                    disabled
                >
                    + Add
                </button>
            </div>
            <!-- Items Container -->
            <div id="itemsContainer" class="flex flex-wrap"></div>
        </div>

        <!-- Vertical Divider -->
        <div class="w-px bg-gray-200 mx-4"></div>

        <!-- Right Panel -->
        <div id="priceSection" class="flex-1 hidden overflow-x-auto">
            <p class="text-md text-gray-900 font-medium mb-2">Enter Price</p>

            <div class="bg-white rounded-2xl shadow-xl p-4 w-full max-w-2xl mt-3">
                <table class="w-full table-auto border-separate border-spacing-y-4">
                    <thead>
                        <tr class="bg-[#54B7C5] text-white rounded">
                            <th class="py-4 px-3 text-left rounded-l-xl">Selected Dishes</th>
                            <th class="py-4 px-3 text-left">PDF</th>
                        </tr>
                    </thead>
                    <tbody id="priceTableBody">
                        <!-- New rows will be added here -->
                    </tbody>
                </table>
            </div>
            <button
                id="saveButton"
                class="shadow-xl p-3 w-full mt-3 max-w-2xl rounded-md bg-[#163F75] hover:bg-[#163F75]/90 text-white"
            >
                Save
            </button>
        </div>
    </div>
    <!-- Note Modal For File Upload -->
    <div
        class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden"
        id="noteModal"
    >
        <!-- Modal Content -->
        <div class="bg-[#F6F9FC] rounded-2xl shadow-lg w-[90%] max-w-md p-6 text-center relative">
            <!-- Close Icon -->
            <button
                class="absolute top-4 right-4 text-red-400 hover:text-red-600 text-xl font-bold"
                onclick="document.getElementById('noteModal').classList.add('hidden')"
                aria-label="Close"
            >
                Close &times;
            </button>

            <!-- Title -->
            <h2 class="text-xl font-semibold mb-4">Note</h2>

            <!-- Message -->
            <p class="text-gray-600 mb-6">
                We assume that the ingredient PDF has already been approved by the admin via email.
            </p>

            <!-- Action Buttons -->
            <div class="flex justify-center gap-4">
                <button
                    onclick="document.getElementById('noteModal').classList.add('hidden')"
                    class="border border-[#163F75] text-[#163F75] px-5 py-2 rounded-lg font-medium hover:bg-[#163F75]/10"
                >
                    Cancel
                </button>

                <button
                    onclick="window.location.href='/spadmin/products'"
                    class="bg-[#163F75] text-white px-5 py-2 rounded-lg font-medium hover:bg-[#102f59]"
                >
                    Upload
                </button>
            </div>
        </div>
    </div>
</div>
<div id="toast-container" class="fixed top-5 right-5 z-[9999] space-y-4"></div>

<script>
    let itemIndex = 0;

    document.getElementById("saveButton").addEventListener("click", function (e) {
        const rows = document.querySelectorAll("#priceTableBody tr");
        let allFilesUploaded = true;

        rows.forEach((row) => {
            const fileInput = row.querySelector("input[type='file']");
            if (!fileInput || !fileInput.files.length) {
                allFilesUploaded = false;
            }
        });

        if (!allFilesUploaded) {
            showToast("Please upload a PDF file for all items before saving.", "error");
        } else {
            document.getElementById("noteModal").classList.remove("hidden");
        }
    });

    function showToast(message, type = "error") {
        const icons = {
            success: {
                color: "green",
                svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/></svg>`,
            },
            error: {
                color: "red",
                svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"/></svg>`,
            },
            warning: {
                color: "orange",
                svg: `<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM10 15a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm1-4a1 1 0 0 1-2 0V6a1 1 0 0 1 2 0v5Z"/></svg>`,
            },
        };

        const { color, svg } = icons[type] || icons.error;
        const toast = document.createElement("div");

        toast.className = `flex items-center w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow-sm border-l-4 border-${color}-500`;
        toast.innerHTML = `
        <div class="inline-flex items-center justify-center shrink-0 w-8 h-8 text-${color}-500 bg-${color}-100 rounded-lg mr-3">
            ${svg}
        </div>
        <div class="text-sm font-normal flex-1">${message}</div>
        <button type="button" class="ml-2 text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8" onclick="this.parentElement.remove()">
            <span class="sr-only">Close</span>
            <svg class="w-3 h-3" fill="none" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
            </svg>
        </button>
    `;

        document.getElementById("toast-container").appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 4000);
    }

    function handleCategoryChange() {
        const select = document.getElementById("category");
        const display = document.getElementById("selectedCategory");
        const selectedText = select.options[select.selectedIndex].text;
        display.textContent = selectedText;
    }

    const categorySelect = document.getElementById("category");
    const addItemInput = document.getElementById("addItemInput");
    const addItemButton = document.getElementById("addItemBtn");
    const priceTableBody = document.getElementById("priceTableBody");

    // Enable/disable input based on category
    function updateInputState() {
        const isCategorySelected = categorySelect.value !== "";
        addItemInput.disabled = !isCategorySelected;
        addItemButton.disabled = !isCategorySelected;

        if (isCategorySelected) {
            addItemButton.classList.remove("bg-[#b6c1d2]");
            addItemButton.classList.add("bg-[#163F75]", "hover:bg-[#0f2f59]");
        } else {
            addItemButton.classList.remove("bg-[#163F75]", "hover:bg-[#0f2f59]");
            addItemButton.classList.add("bg-[#b6c1d2]");
        }
    }

    categorySelect.addEventListener("change", updateInputState);
    window.addEventListener("load", updateInputState);

    function handleUpload(input, itemIndex) {
        const button = document.getElementById(`uploadBtn-${itemIndex}`);
        const file = input.files[0];

        if (file) {
            button.innerHTML = `
            Uploaded
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#54B7C5] hover:bg-teal-100" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                `;

            button.classList.add("text-[#54B7C5]", "border-[#54B7C5]");
            button.onclick = () => {
                input.value = ""; // Clear file
                button.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5-5m0 0l5 5m-5-5v12" />
            </svg>
            Upload`;
                button.classList.remove("text-[#54B7C5]");
                button.classList.add("text-gray-400");
                button.onclick = () => document.getElementById(`file-${itemIndex}`).click();
            };
        }
    }

    addItemButton.addEventListener("click", () => {
        const item = addItemInput.value.trim();
        if (!item) return;

        // Create a new table row
        const row = document.createElement("tr");
        row.setAttribute("data-item", item); // custom attribute to identify row

        row.innerHTML = `
                          <td class="py-4 px-3 text-gray-600 font-medium">${item}</td>
                          <td class="py-4 px-3">
                            <div class="relative">
                              <input type="file" class="hidden" id="file-${itemIndex}" onchange="handleUpload(this, ${itemIndex})" />
                              <button
                                onclick="document.getElementById('file-${itemIndex}').click()"
                                id="uploadBtn-${itemIndex}"
                                class="flex items-center gap-2 border text-gray-400 border-[#54B7C5] px-4 py-2 rounded-xl font-medium"
                              >
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5-5m0 0l5 5m-5-5v12" />
                                </svg>
                                Upload
                              </button>
                            </div>
                          </td>
                        `;

        priceTableBody.appendChild(row);
        itemIndex++;

        // Create chip with close button
        const chip = document.createElement("div");
        chip.className =
            "flex items-center px-4 py-1 m-3 rounded-md bg-[#54B7C5] text-white text-sm";
        chip.setAttribute("data-item", item); // custom attribute to identify chip
        chip.innerHTML = `
        <span>${item}</span>
        <button class="ml-2 text-white font-bold hover:text-red-200">&times;</button>
        `;

        // Handle chip remove
        chip.querySelector("button").addEventListener("click", () => {
            // Remove chip
            chip.remove();

            // Remove corresponding table row
            const matchingRow = priceTableBody.querySelector(`tr[data-item="${item}"]`);
            if (matchingRow) matchingRow.remove();

            // If no more chips left, hide the price section
            const remainingChips = document.querySelectorAll("#itemsContainer > div");
            if (remainingChips.length === 0) {
                document.getElementById("priceSection").classList.add("hidden");
            }
        });

        document.getElementById("itemsContainer").appendChild(chip);

        // Show price section
        document.getElementById("priceSection").classList.remove("hidden");

        // Handle line-through logic
        const originalInput = row.querySelector("td:nth-child(2) input");
        const discountInput = row.querySelector("td:nth-child(3) input");

        function updateLineThrough() {
            const origVal = originalInput.value.trim();
            const discVal = discountInput.value.trim();

            if (origVal !== "" && discVal !== "") {
                originalInput.classList.add("line-through");
            } else {
                originalInput.classList.remove("line-through");
            }
        }

        originalInput.addEventListener("input", updateLineThrough);
        discountInput.addEventListener("input", updateLineThrough);

        addItemInput.value = "";
    });
</script>
